<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>🎓 Registered Students by Department</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    #student-context-menu {
      display: none;
      position: absolute;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      border-radius: 4px;
      min-width: 140px;
    }
    #student-context-menu ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    #student-context-menu ul li a {
      display: block;
      padding: 8px 12px;
      text-decoration: none;
      color: #333;
      cursor: pointer;
    }
    #student-context-menu ul li a:hover {
      background-color: #f8f9fa;
      color: #000;
    }
    /* Optional: subtle hover highlight for table rows */
    table tbody tr:hover {
      background-color: #f1f3f5;
    }
  </style>
</head>
<body class="p-4 bg-light">

<div class="container">
  <h3 class="mb-3">🎓 Registered Students by Department</h3>

  <!-- Back Button -->
  <a href="/admin" class="btn btn-secondary mb-4">← Back to Admin Dashboard</a>

  <!-- Flash messages -->
  {% if request.args.get('message') %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ request.args.get('message') }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endif %}
  {% if request.args.get('error') %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      {{ request.args.get('error') }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endif %}

  <!-- Filter Form -->
  <form method="get" class="mb-3">
    <label for="department" class="form-label fw-semibold">Filter by Department:</label>
    <select name="department" id="department" class="form-select w-50 d-inline-block" onchange="this.form.submit()">
      <option value="">-- Select Department --</option>
      <option value="All" {% if selected_dept == 'All' %}selected{% endif %}>All Departments</option>
      {% for dept in all_departments %}
        <option value="{{ dept.name }}" {% if dept.name == selected_dept %}selected{% endif %}>{{ dept.name }}</option>
      {% endfor %}
    </select>
  </form>

  {% if selected_dept %}
    <h5 class="mb-3">Showing students in: <strong>{{ selected_dept }}</strong></h5>

    {% if students %}
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle">
          <thead class="table-dark">
            <tr>
              <th scope="col" style="width:5%;">#</th>
              <th scope="col">Student Name</th>
              <th scope="col">Department</th>
            </tr>
          </thead>
          <tbody>
            {% for student in students %}
            <tr class="student-item" data-studentid="{{ student.id }}">
              <th scope="row">{{ loop.index }}</th>
              <td>{{ student.name }}</td>
              <td>{{ student.department }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted fst-italic">No students found in this department.</p>
    {% endif %}
  {% endif %}
</div>

<!-- Custom Context Menu -->
<div id="student-context-menu">
  <ul class="mb-0">
    <li><a href="#" id="edit-student-link">✏️ Edit Student</a></li>
    <li><a href="#" id="delete-student-link" class="text-danger">🗑️ Delete Student</a></li>
  </ul>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const contextMenu = document.getElementById('student-context-menu');
  let currentStudentId = null;

  // Right-click to show context menu on table rows with student-item class
  document.querySelectorAll('.student-item').forEach(item => {
    item.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      currentStudentId = this.dataset.studentid;

      contextMenu.style.top = `${e.pageY}px`;
      contextMenu.style.left = `${e.pageX}px`;
      contextMenu.style.display = 'block';

      document.getElementById('edit-student-link').href = `/admin/edit-student/${currentStudentId}`;
      document.getElementById('delete-student-link').href = `/admin/delete-student/${currentStudentId}`;
    });
  });

  // Click elsewhere to hide context menu
  document.addEventListener('click', function(e) {
    if (!contextMenu.contains(e.target)) {
      contextMenu.style.display = 'none';
    }
  });

  // Prevent default context menu on the table
  document.querySelector('table')?.addEventListener('contextmenu', e => e.preventDefault());
</script>

</body>
</html>
