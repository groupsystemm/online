<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>🎓 Students by Department</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    /* Context menu styles */
    #student-context-menu {
      display: none;
      position: absolute;
      z-index: 1000;
      background: white;
      border: 1px solid #ccc;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      border-radius: 4px;
      min-width: 140px;
    }
    #student-context-menu ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    #student-context-menu ul li a {
      display: block;
      padding: 8px 12px;
      text-decoration: none;
      color: #333;
      cursor: pointer;
    }
    #student-context-menu ul li a:hover {
      background-color: #f8f9fa;
      color: #000;
    }
  </style>
</head>
<body class="p-4 bg-light">

<div class="container">
  <h3 class="mb-4">🎓 Students by Department</h3>

  <form method="get" class="mb-3">
    <label for="department" class="form-label">Filter by Department:</label>
    <select name="department" id="department" class="form-select w-50 d-inline-block" onchange="this.form.submit()">
      <option value="">-- Select Department --</option>
      <option value="All" {% if selected_dept == 'All' %}selected{% endif %}>All Departments</option>
      {% for dept in all_departments %}
        <option value="{{ dept.name }}" {% if dept.name == selected_dept %}selected{% endif %}>
          {{ dept.name }}
        </option>
      {% endfor %}
    </select>
  </form>

  {% if selected_dept %}
    <h5>Showing students from: <strong>{{ selected_dept }}</strong></h5>

    {% if students %}
      <ul class="list-group mt-3" id="students-list">
        {% for student in students %}
          <li class="list-group-item student-item" data-studentid="{{ student.id }}">
            {{ student.name }} <small class="text-muted">({{ student.department }})</small>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="text-muted">No students registered in this department.</p>
    {% endif %}
  {% endif %}
</div>

<!-- Context Menu -->
<div id="student-context-menu">
  <ul>
    <li><a href="#" id="edit-student-link">✏️ Edit Student</a></li>
    <li><a href="#" id="delete-student-link" class="text-danger">🗑️ Delete Student</a></li>
  </ul>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const contextMenu = document.getElementById('student-context-menu');
  let currentStudentId = null;

  // Show context menu on right-click on a student item
  document.querySelectorAll('.student-item').forEach(item => {
    item.addEventListener('contextmenu', function(e) {
      e.preventDefault();
      currentStudentId = this.dataset.studentid;

      contextMenu.style.top = `${e.pageY}px`;
      contextMenu.style.left = `${e.pageX}px`;
      contextMenu.style.display = 'block';

      document.getElementById('edit-student-link').href = `/admin/edit-student/${currentStudentId}`;
      document.getElementById('delete-student-link').href = `/admin/delete-student/${currentStudentId}`;
    });
  });

  // Hide context menu when clicking elsewhere
  document.addEventListener('click', function(e) {
    if (!contextMenu.contains(e.target)) {
      contextMenu.style.display = 'none';
    }
  });

  // Optional: prevent browser context menu on student list
  document.getElementById('students-list').addEventListener('contextmenu', e => e.preventDefault());
</script>

</body>
</html>
