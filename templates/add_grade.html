{% extends "layout.html" %}
{% block title %}Add Grade{% endblock %}

{% block content %}
<div class="card shadow-sm p-4">
  <h2 class="text-center text-primary mb-4">ğŸ“Š Add Grade</h2>

  {% if message %}
    <div class="alert alert-success text-center">{{ message }}</div>
  {% elif error %}
    <div class="alert alert-danger text-center">{{ error }}</div>
  {% endif %}

  <!-- Filter by Department -->
  <form method="GET" action="/add-grade" class="mb-4">
    <div class="row">
      <div class="col-md-6 offset-md-3">
        <label for="departmentFilter" class="form-label">ğŸ« Filter by Department:</label>
        <select id="departmentFilter" name="department" class="form-select" onchange="this.form.submit()">
          <option value="" {% if not selected_dept %}selected{% endif %}>-- All Departments --</option>
          {% for dept in departments %}
            <option value="{{ dept.name }}" {% if dept.name == selected_dept %}selected{% endif %}>
              {{ dept.name }}
            </option>
          {% endfor %}
        </select>
      </div>
    </div>
  </form>

  <!-- Grade Entry Form -->
  <form method="POST" novalidate>
    <div class="row mb-3">
      <div class="col-md-6">
        <label for="studentSelect" class="form-label">ğŸ‘©â€ğŸ“ Select Student:</label>
        <select id="studentSelect" name="student_id" class="form-select" required>
          <option disabled selected>Select a student</option>
          {% for student in students %}
            <option value="{{ student.id }}">{{ student.name }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-6">
        <label for="courseSelect" class="form-label">ğŸ“š Select Course:</label>
        <select id="courseSelect" name="course_id" class="form-select" required>
          <option disabled selected>Select a course</option>
          {% for course in courses %}
            <option value="{{ course.id }}">{{ course.course_name }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="mb-3">
      <label for="semesterSelect" class="form-label">ğŸ•“ Semester</label>
      <select id="semesterSelect" name="semester" class="form-select" required>
        <option disabled selected>Select semester</option>
        <option value="1">1st Semester</option>
        <option value="2">2nd Semester</option>
        <option value="3">3rd Semester</option>
      </select>
    </div>

    <div class="row mb-3">
      <div class="col-md-3">
        <label for="mid" class="form-label">ğŸ§® Mid Exam (30%)</label>
        <input type="number" id="mid" name="mid_exam" class="form-control" min="0" max="100" step="0.01" required>
      </div>
      <div class="col-md-3">
        <label for="final" class="form-label">ğŸ“š Final Exam (40%)</label>
        <input type="number" id="final" name="final_exam" class="form-control" min="0" max="100" step="0.01" required>
      </div>
      <div class="col-md-3">
        <label for="assignment" class="form-label">âœï¸ Assignment (20%)</label>
        <input type="number" id="assignment" name="assignment" class="form-control" min="0" max="100" step="0.01" required>
      </div>
      <div class="col-md-3">
        <label for="quiz" class="form-label">ğŸ“ Quiz (10%)</label>
        <input type="number" id="quiz" name="quiz" class="form-control" min="0" max="100" step="0.01" required>
      </div>
    </div>

    <!-- Live Weighted Calculation -->
    <div class="text-center mb-4">
      <span class="badge bg-info">Total (weighted): <span id="total">-</span></span>
      <span class="badge bg-secondary ms-3">Letter Grade: <span id="letter">-</span></span>
    </div>

    <div class="text-center">
      <button type="submit" class="btn btn-success">âœ… Submit Grade</button>
      <a href="/teacher/dashboard" class="btn btn-outline-secondary ms-3">â¬…ï¸ Back</a>
    </div>
  </form>
</div>

<script>
  const mid = document.getElementById("mid");
  const finalExam = document.getElementById("final");
  const assignment = document.getElementById("assignment");
  const quiz = document.getElementById("quiz");

  function calcGrade() {
    const m = parseFloat(mid.value) || 0;
    const f = parseFloat(finalExam.value) || 0;
    const a = parseFloat(assignment.value) || 0;
    const q = parseFloat(quiz.value) || 0;

      const total = m + f + a + q;
    document.getElementById("total").innerText = total;

    let letter = "-";
    if (total >= 90) letter = "A+";
    else if (total >= 80) letter = "A";
    else if (total >= 70) letter = "B+";
    else if (total >= 60) letter = "B";
    else if (total >= 50) letter = "C";
    else letter = "F";

    document.getElementById("letter").innerText = letter;
  }

  [mid, finalExam, assignment, quiz].forEach(el => el.addEventListener("input", calcGrade));
</script>
{% endblock %}
